name: Decompile Groovepad XAPK (Windows)

on:
  workflow_dispatch:

jobs:
  decompile:
    runs-on: windows-latest

    steps:
      - name: Checkout repo
        uses: actions/checkout@v4

      - name: Download XAPK
        shell: powershell
        run: |
          mkdir xapk
          Invoke-WebRequest -Uri "https://github.com/SuperiorTeam09/Library/releases/download/Main/Groovepad.-.music.beat.maker_1.26.0_APKPure.xapk" -OutFile "xapk/app.xapk"

      - name: Extract XAPK
        shell: powershell
        run: |
          Expand-Archive "xapk/app.xapk" "xapk/unpacked"
          mkdir apk
          Get-ChildItem "xapk/unpacked" -Filter *.apk | Copy-Item -Destination apk

      - name: Install 7zip
        uses: crazy-max/ghaction-chocolatey@v3
        with:
          args: install 7zip

      - name: Download JADX
        shell: powershell
        run: |
          Invoke-WebRequest -Uri "https://github.com/skylot/jadx/releases/latest/download/jadx.zip" -OutFile "jadx.zip"
          7z x jadx.zip -ojadx

      - name: Run JADX
        shell: powershell
        run: |
          mkdir output
          foreach ($apk in Get-ChildItem "apk" -Filter *.apk) {
            $name = $apk.BaseName
            Write-Host "Decompiling $name..."
            .\jadx\bin\jadx.bat "$($apk.FullName)" -d "output\$name"
          }

      - name: Upload Decompiled Files
        uses: actions/upload-artifact@v4
        with:
          name: groovepad-decompiled
          path: output
