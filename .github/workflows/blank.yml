name: Decompile Groovepad XAPK

on:
  workflow_dispatch:

jobs:
  decompile:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repo
        uses: actions/checkout@v4

      - name: Install tools
        run: |
          sudo apt-get update
          sudo apt-get install -y unzip wget jadx

      - name: Download XAPK
        run: |
          mkdir xapk
          wget "https://github.com/SuperiorTeam09/Library/releases/download/Main/Groovepad.-.music.beat.maker_1.26.0_APKPure.xapk" \
              -O xapk/app.xapk

      - name: Extract XAPK
        run: |
          unzip xapk/app.xapk -d xapk/unpacked
          mkdir apk
          cp xapk/unpacked/*.apk apk/ || true
          echo "Extracted APKs:"
          ls apk/

      - name: Run Jadx
        run: |
          mkdir output
          for file in apk/*.apk; do
            name=$(basename "$file" .apk)
            echo "Decompiling $name..."
            jadx "$file" -d output/"$name"
          done

      - name: Upload Decompiled Files
        uses: actions/upload-artifact@v4
        with:
          name: groovepad-jadx-output
          path: output
